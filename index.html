<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Literatura espa√±ola hasta el siglo XVIII</title>
  <style>
    :root{
      --fg:#1f2937; --bg:#ffffff; --border:#e5e7eb; --brand:#111827;
      --medieval:#fef3c7; --rena:#dcfce7; --cerv:#e5e7eb; --barroco:#fae8ff; --ilustra:#dbeafe; --card:#ffffff;
    }
    html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial}
    a{color:inherit;text-decoration:none}
    .container{max-width:1100px;margin:0 auto;padding:1rem}
    :target{scroll-margin-top:72px}

    /* NAV */
    .nav{position:sticky;top:0;z-index:20;background:rgba(255,255,255,.96);backdrop-filter:saturate(180%) blur(10px);border-bottom:1px solid var(--border)}
    .nav .inner{display:flex;gap:.5rem;align-items:center}
    .brand{font-weight:800}
    .spacer{flex:1}
    .links{display:flex;gap:.5rem;align-items:center}
    .links a{display:inline-block;padding:.5rem .75rem;border:1px solid var(--border);border-radius:9999px;background:#fff;white-space:nowrap}
    .hamb{display:none;appearance:none;border:1px solid var(--border);background:#fff;border-radius:.75rem;padding:.5rem .6rem}
    .mobile-panel{display:none;position:fixed;top:56px;left:0;right:0;background:#fff;border-bottom:1px solid var(--border);box-shadow:0 6px 20px rgba(0,0,0,.06)}
    .mobile-panel .row{display:flex;overflow-x:auto;gap:.5rem;padding:.75rem 1rem}
    .mobile-panel a{display:inline-block;padding:.5rem .75rem;border:1px solid var(--border);border-radius:9999px;background:#fff;white-space:nowrap}

    /* Layout */
    .section{padding:3rem 0;position:relative;overflow:hidden}
    .section > .container{position:relative;z-index:1}
    .section::before{
      content:""; position:absolute; inset:0; z-index:0;
      background-position:center; background-repeat:no-repeat; background-size:cover;
      opacity:.35;
    }

    /* Colores base */
    #edad-media{background:var(--medieval)}
    #renacimiento{background:var(--rena)}
    #cervantes{background:var(--cerv)}
    #barroco{background:var(--barroco)}
    #ilustracion{background:var(--ilustra)}

    /* Fondos */
    #edad-media::before{background-image:url("materials/img/edad-media.jpg?v=3")}
    #renacimiento::before{background-image:url("materials/img/renacimiento.jpg?v=3")}
    #cervantes::before{background-image:url("materials/img/cervantes.jpg?v=3")}
    #barroco::before{background-image:url("materials/img/barroco.jpg?v=3")}
    #ilustracion::before{background-image:url("materials/img/ilustracion.jpg?v=3")}

    h1{font-size:clamp(1.8rem,2.5vw,3rem);margin:.3rem 0}
    h2{font-size:clamp(1.5rem,2vw,2.2rem);margin:0 0 .5rem 0}
    h3{margin:.5rem 0}
    .muted{color:#374151;font-size:.95rem}
    .btn{display:inline-block;padding:.6rem 1rem;border-radius:9999px;border:1px solid var(--border);background:#fff;cursor:pointer}
    .btn.primary{background:var(--brand);color:#fff;border-color:var(--brand)}
    .list{padding-left:1.1rem}
    .list li{margin:.35rem 0}
    .footer{border-top:1px solid var(--border);padding:1rem 0;color:#6b7280}
    .card{background:rgba(255,255,255,.92);border:1px solid var(--border);border-radius:1rem;padding:1rem}
    @media(max-width:899px){.card{background:rgba(255,255,255,.96)}}
    .grid{display:grid;gap:1rem}
    @media(min-width:900px){.grid-3{grid-template-columns: 1fr 1fr 1fr;}}
    .chip{display:inline-block;padding:.25rem .6rem;border:1px solid var(--border);border-radius:9999px;margin:.15rem .25rem;background:#fff;cursor:pointer}
    .chip.active{background:#111827;color:#fff;border-color:#111827}
    .hint{font-size:.9rem;color:#334155;margin:.25rem 0 .5rem}

    table{width:100%;border-collapse:collapse}
    th,td{border:1px solid var(--border);padding:.6rem;text-align:left}
    th{background:#f8fafc}

    /* Flashcards */
    .flash-controls{display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:1rem;align-items:center}
    .flash-grid{display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}
    .flashcard{border:1px solid var(--border);border-radius:1rem;padding:1rem;background:#fff;text-align:left;cursor:pointer;transition:transform .15s ease, box-shadow .15s ease;min-height:160px}
    .flashcard:hover{transform:translateY(-2px);box-shadow:0 12px 30px rgba(0,0,0,.06)}
    .flash-label{font-size:.85rem;color:#475569;font-weight:600}
    .flash-question{margin:.4rem 0 .6rem 0;font-weight:700;line-height:1.3}
    .flash-answer{margin:0;color:#111827;display:none;line-height:1.35}
    .flashcard.show-answer .flash-answer{display:block}
    .flashcard.show-answer{border-color:#111827}

    /* Quiz */
    .quiz{margin-top:1.5rem;padding:1rem;border:1px solid var(--border);border-radius:1rem;background:#fff}
    .quiz h3{margin:.2rem 0 0.5rem 0}
    .quiz-meta{display:flex;gap:.75rem;align-items:center;font-size:.95rem;color:#475569}
    .quiz-question{font-weight:700;line-height:1.4;margin:.75rem 0}
    .quiz-options{display:grid;gap:.5rem}
    .quiz-options button{display:flex;gap:.6rem;align-items:flex-start;text-align:left;border:1px solid var(--border);border-radius:.75rem;padding:.65rem .8rem;background:#fff;cursor:pointer;transition:border-color .15s ease, box-shadow .15s ease}
    .quiz-options button:hover{border-color:#111827}
    .quiz-options button.active{border-color:#111827;box-shadow:0 8px 16px rgba(0,0,0,.05)}
    .quiz-options .letter{font-weight:800;color:#111827;min-width:20px}
    .quiz-feedback{margin:.5rem 0 0 0;font-weight:600}
    .quiz-feedback.ok{color:#15803d}
    .quiz-feedback.bad{color:#b91c1c}
    .quiz-actions{display:flex;gap:.5rem;flex-wrap:wrap;margin-top:.5rem}
    .quiz-hint{display:none;margin-top:.25rem}
    .quiz-hint.show{display:block}

    @media (max-width:899px){.links{display:none}.hamb{display:inline-block}.container{padding:.75rem 1rem}.section{padding:2rem 0}}
    .nav.open .mobile-panel{display:block}

    /* Visor PDF */
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;z-index:50}
    .overlay.show{display:block}
    .viewer{position:fixed;inset:5% 3%;background:#111827;border-radius:1rem;box-shadow:0 25px 50px rgba(0,0,0,.35);display:none;flex-direction:column;z-index:60}
    .viewer .top{display:flex;align-items:center;gap:.5rem;padding:.6rem .75rem;background:#0f172a;color:#fff;border-top-left-radius:1rem;border-top-right-radius:1rem;flex-wrap:wrap}
    .viewer .top .spacer{flex:1}
    .viewer .btn{border-color:#334155;background:#fff;color:#0f172a;font-weight:600;padding:.45rem .8rem;border-radius:.65rem;text-decoration:none;display:inline-flex;align-items:center;gap:.4rem}
    .viewer iframe{flex:1;border:0;border-bottom-left-radius:1rem;border-bottom-right-radius:1rem;background:#fff}
    @media (max-width:640px){ .viewer{inset:4% 2%} .viewer .btn{flex:1;justify-content:center;min-width:120px} #fileName{flex-basis:100%;font-size:1rem} }

    /* Frame app versos */
    .app-frame{position:relative;width:100%;height:70vh;min-height:520px;border:1px solid var(--border);border-radius:1rem;overflow:hidden;background:#fff}
    .app-frame iframe{position:absolute;inset:0;width:100%;height:100%;border:0}
    @media (max-width: 640px){
      .app-frame{height:65vh;min-height:460px}
    }
  </style>
</head>
<body>
  <!-- NAV -->
  <div class="nav" id="nav">
    <div class="container inner">
      <div class="brand">üìö Lit. espa√±ola ‚ü∂ s. XVIII</div>
      <div class="spacer"></div>
      <div class="links" aria-label="Men√∫ principal">
        <a href="#edad-media">Edad Media</a>
        <a href="#renacimiento">Renacimiento</a>
        <a href="#cervantes">Cervantes</a>
        <a href="#barroco">Barroco</a>
        <a href="#ilustracion">Ilustraci√≥n</a>
        <a href="#repaso">Repaso para el examen</a>
        <a href="#descargas">Descargas</a>
        <a href="#foro">Foro</a>
        <a href="#miniserie">Miniserie</a>
        <a href="#versos">Generador de versos</a>
      </div>
      <button class="hamb" id="hamb" aria-label="Abrir men√∫">‚ò∞</button>
    </div>
    <div class="mobile-panel" id="mobilePanel">
      <div class="row">
        <a href="#edad-media">Edad Media</a>
        <a href="#renacimiento">Renacimiento</a>
        <a href="#cervantes">Cervantes</a>
        <a href="#barroco">Barroco</a>
        <a href="#ilustracion">Ilustraci√≥n</a>
        <a href="#repaso">Repaso para el examen</a>
        <a href="#descargas">Descargas</a>
        <a href="#foro">Foro</a>
        <a href="#miniserie">Miniserie</a>
        <a href="#versos">Generador de versos</a>
      </div>
    </div>
  </div>

  <!-- HOME -->
  <section class="section" id="home">
    <div class="container">
      <h1>Literatura espa√±ola hasta el siglo XVIII</h1>
      <p class="muted">Cinco √©pocas, materiales completos y <b>cuadernos de la sesi√≥n</b>. En m√≥vil, los PDF se abren dentro de la web (bot√≥n <b>Volver</b>).</p>
    </div>
  </section>

  <!-- REPASO -->
  <section class="section" id="repaso">
    <div class="container">
      <h2>üß† Repaso para el examen</h2>
      <div class="card">
        <p class="hint">Pulsa cada tarjeta para revelar la respuesta. Puedes barajar el orden cuando quieras.</p>
        <div style="margin:0 0 1rem 0;display:flex;gap:.5rem;flex-wrap:wrap">
          <button class="btn primary" data-pdf="materials/presentaciones/repaso.pdf">üìë Ver presentaci√≥n de repaso (PDF)</button>
          <a class="btn" href="materials/presentaciones/repaso.pdf" target="_blank" rel="noopener">‚ÜóÔ∏è Abrir en pesta√±a nueva</a>
        </div>
        <div class="flash-controls">
          <button class="btn" id="shuffleCards">üîÄ Barajar</button>
          <button class="btn" id="resetCards">‚Ü©Ô∏è Volver al orden original</button>
          <span class="muted" id="flashMeta"></span>
        </div>
        <div class="flash-grid" id="flashcards"></div>
        <div class="quiz" id="quizBox">
          <h3>Cuestionario interactivo</h3>
          <div class="quiz-meta">
            <span id="quizProgress">Pregunta 1/10</span>
            <span id="quizScore">Aciertos: 0</span>
          </div>
          <p class="quiz-question" id="quizQuestion"></p>
          <div class="quiz-options" id="quizOptions"></div>
          <div class="quiz-actions">
            <button class="btn" id="quizHint">üí° Pista</button>
            <button class="btn primary" id="quizCheck">Comprobar</button>
            <button class="btn" id="quizNext">Siguiente</button>
          </div>
          <p class="quiz-feedback" id="quizFeedback"></p>
          <p class="quiz-hint muted" id="quizHintText"></p>
        </div>
      </div>
    </div>
  </section>

  <!-- EDAD MEDIA -->
  <section class="section" id="edad-media">
    <div class="container">
      <h2>üõ°Ô∏è Edad Media</h2>
      <div class="grid grid-3">
        <div class="card">
          <h3>Materiales completos</h3>
          <ul class="list">
            <li><button class="btn" data-pdf="materials/1. Edad Media.pdf">‚¨áÔ∏è Unidad 1. La literatura en la Edad Media (PDF)</button></li>
          </ul>
          <p class="muted">Tambi√©n puedes <a href="materials/1. Edad Media.pdf" target="_blank" rel="noopener">abrir en pesta√±a nueva</a>.</p>

          <!-- Presentaci√≥n Prezi -->
          <div style="margin-top: 1rem;">
            <h4 style="font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--text-secondary);">Presentaci√≥n interactiva</h4>
            <div style="position: relative; overflow: hidden; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
              <iframe src="https://prezi.com/p/embed/gd3me8apzjur/" id="iframe_container" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen="" allow="autoplay; fullscreen" height="315" width="100%" style="border: none;"></iframe>
            </div>
          </div>
        </div>
        <div class="card">
          <h3>Contexto y claves</h3>
          <ul class="list">
            <li><b>Obra/autor:</b> Cantar de Mio Cid (an√≥nimo)</li>
            <li><b>Claves:</b> vasallaje ¬∑ teocentrismo ¬∑ frontera feudal</li>
            <li><b>Tensi√≥n:</b> honra/realismo, oralidad/escritura</li>
          </ul>
        </div>
        <div class="card">
          <h3>Cuadernos de la sesi√≥n</h3>
          <p class="hint">Pulsa la sesi√≥n para abrir el cuaderno. En el visor podr√°s <b>descargar</b> o <b>abrir en pesta√±a</b>.</p>
          <div id="chips-edad-media"></div>
          <ul class="list" id="lista-edad-media"></ul>
        </div>
      </div>
    </div>
  </section>

  <!-- RENACIMIENTO -->
  <section class="section" id="renacimiento">
    <div class="container">
      <h2>üèõÔ∏è Renacimiento</h2>
      <div class="grid grid-3">
        <div class="card">
          <h3>Materiales completos</h3>
          <ul class="list">
            <li><button class="btn" data-pdf="materials/2. Renacimiento.pdf">‚¨áÔ∏è Unidad 2. El Renacimiento (PDF)</button></li>
            <li><a href="materials/presentaciones/renacimiento/lazarillo/index.html" target="_blank" class="btn">üìñ Presentaci√≥n: Lazarillo de Tormes</a></li>
          </ul>
          <p class="muted">Tambi√©n puedes <a href="materials/2. Renacimiento.pdf" target="_blank" rel="noopener">abrir en pesta√±a nueva</a>.</p>
        </div>
        <div class="card">
          <h3>Contexto y claves</h3>
          <ul class="list">
            <li><b>Autor:</b> Garcilaso de la Vega</li>
            <li><b>Claves:</b> humanismo ¬∑ armon√≠a ¬∑ naturaleza ideal</li>
            <li><b>Contraste:</b> equilibrio renacentista vs. contraste barroco</li>
          </ul>
        </div>
        <div class="card">
          <h3>Cuadernos de la sesi√≥n</h3>
          <p class="hint">Pulsa la sesi√≥n para abrir.</p>
          <div id="chips-renacimiento"></div>
          <ul class="list" id="lista-renacimiento"></ul>
        </div>
      </div>
    </div>
  </section>

  <!-- CERVANTES -->
  <section class="section" id="cervantes">
    <div class="container">
      <h2>ü™∂ Cervantes</h2>
      <div class="grid grid-3">
        <div class="card">
          <h3>Materiales completos</h3>
          <ul class="list">
            <li><button class="btn" data-pdf="materials/3. Cervantes.pdf">‚¨áÔ∏è Unidad 3. Cervantes (PDF)</button></li>
          </ul>
          <p class="muted">Tambi√©n puedes <a href="materials/3. Cervantes.pdf" target="_blank" rel="noopener">abrir en pesta√±a nueva</a>.</p>
        </div>
        <div class="card">
          <h3>Contexto y claves</h3>
          <ul class="list">
            <li><b>Obra:</b> Don Quijote de la Mancha</li>
            <li><b>Claves:</b> imprenta/mercado ¬∑ perspectivismo ¬∑ verosimilitud</li>
            <li><b>Tensi√≥n:</b> idealismo vs. realidad</li>
          </ul>
        </div>
        <div class="card">
          <h3>Cuadernos de la sesi√≥n</h3>
          <div id="chips-cervantes"></div>
          <ul class="list" id="lista-cervantes"></ul>
        </div>
      </div>
    </div>
  </section>

  <!-- BARROCO -->
  <section class="section" id="barroco">
    <div class="container">
      <h2>üé≠ Barroco</h2>
      <div class="grid grid-3">
        <div class="card">
          <h3>Materiales completos</h3>
          <ul class="list">
            <li><button class="btn" data-pdf="materials/4. Barroco.pdf">‚¨áÔ∏è Unidad 4. Barroco (PDF)</button></li>
          </ul>
          <p class="muted">Tambi√©n puedes <a href="materials/4. Barroco.pdf" target="_blank" rel="noopener">abrir en pesta√±a nueva</a>.</p>
        </div>
        <div class="card">
          <h3>Contexto y claves</h3>
          <ul class="list">
            <li><b>Autores:</b> Lope, Calder√≥n, G√≥ngora, Quevedo</li>
            <li><b>Claves:</b> crisis ¬∑ absolutismo ¬∑ teatro/industria</li>
            <li><b>Estilo:</b> culteranismo/conceptismo</li>
          </ul>
        </div>
        <div class="card">
          <h3>Cuadernos de la sesi√≥n</h3>
          <p class="hint">Pulsa la sesi√≥n para abrir el cuaderno. En el visor podr√°s <b>descargar</b> o <b>abrir en pesta√±a</b>.</p>
          <div id="chips-barroco"></div>
          <ul class="list" id="lista-barroco"></ul>
        </div>
      </div>
    </div>
  </section>

  <!-- ILUSTRACI√ìN -->
  <section class="section" id="ilustracion">
    <div class="container">
      <h2>üí° Ilustraci√≥n</h2>
      <div class="grid grid-3">
        <div class="card">
          <h3>Materiales completos</h3>
          <ul class="list">
            <li><button class="btn" data-pdf="materials/5. Ilustracion.pdf">‚¨áÔ∏è Unidad 5. Ilustraci√≥n (PDF)</button></li>
          </ul>
          <p class="muted">Tambi√©n puedes <a href="materials/5. Ilustracion.pdf" target="_blank" rel="noopener">abrir en pesta√±a nueva</a>.</p>
        </div>
        <div class="card">
          <h3>Contexto y claves</h3>
          <ul class="list">
            <li><b>Autor:</b> Morat√≠n</li>
            <li><b>Claves:</b> raz√≥n p√∫blica ¬∑ reforma ¬∑ claridad</li>
            <li><b>Giro:</b> del exceso barroco a la regla/claridad</li>
          </ul>
        </div>
        <div class="card">
          <h3>Cuadernos de la sesi√≥n</h3>
          <p class="muted">Pr√≥ximamente.</p>
          <div id="chips-ilustracion"></div>
          <ul class="list" id="lista-ilustracion"></ul>
        </div>
      </div>
    </div>
  </section>

  <!-- DESCARGAS -->
  <section class="section" id="descargas">
    <div class="container">
      <h2>üì• Descargas</h2>
      <div class="card">
        <table>
          <thead><tr><th>Documento</th><th>Acci√≥n</th></tr></thead>
          <tbody>
            <tr><td>Syllabus del curso</td><td><button class="btn" data-pdf="materials/syllabus.pdf">Abrir/descargar</button></td></tr>
            <tr><td>Programa detallado sesi√≥n a sesi√≥n</td><td><button class="btn" data-pdf="materials/programa-detallado.pdf">Abrir/descargar</button></td></tr>
            <tr><td>Cuaderno de actividades (general)</td><td><button class="btn" data-pdf="materials/cuadernos/Modulo1_Literatura_Medieval.pdf">Abrir/descargar</button></td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- FORO -->
  <section class="section" id="foro">
    <div class="container">
      <h2>üí¨ Foro</h2>
      <div class="card">
        <p>Usaremos el foro de la plataforma del centro para usuarios y notificaciones.</p>
        <p><a class="btn primary" href="https://clasesporzoom.com" target="_blank" rel="noreferrer">Abrir foro del curso</a></p>
      </div>
    </div>
  </section>

  <!-- MINISERIE -->
  <section class="section" id="miniserie">
    <div class="container">
      <h2>üé¨ Miniserie del curso</h2>
      <div class="card">
        <div class="grid" style="grid-template-columns:1fr;gap:1rem">
          <label>Obra
            <select id="obra">
              <option>Quijote</option>
              <option>Lazarillo</option>
            </select>
          </label>
          <label>T√≠tulo del cap√≠tulo
            <input id="titulo" placeholder="Ej.: El sue√±o de los molinos" />
          </label>
          <label>Sinopsis breve
            <input id="sinopsis" placeholder="Una l√≠nea que resuma la escena" />
          </label>
          <label>Guion (puedes escribir o modificar la plantilla)
            <textarea id="guion"></textarea>
          </label>
          <div style="display:flex;gap:.5rem;flex-wrap:wrap">
            <button class="btn primary" id="guardar">Descargar .txt</button>
            <button class="btn" id="plantilla">Cargar plantilla</button>
            <button class="btn" id="limpiar">Limpiar</button>
          </div>
        </div>
        <p class="muted" style="margin-top:.75rem">La descarga funciona sin servidor: genera un archivo de texto al momento.</p>
      </div>
    </div>
  </section>

  <!-- GENERADOR DE VERSOS (incrustado, sin bot√≥n) -->
  <section class="section" id="versos">
    <div class="container">
      <h2>ü™∂ Generador de versos medievales</h2>
      <div class="card">
        <p class="muted">Usa el generador directamente aqu√≠ (mejor en horizontal si est√°s en m√≥vil).</p>
        <div class="app-frame">
          <iframe
            id="versosFrame"
            title="Generador de versos medievales"
            src="https://g0sva8c1k280-deploy.space.z.ai/"
            loading="lazy"
            allow="clipboard-write; fullscreen"
            referrerpolicy="no-referrer"
          ></iframe>
        </div>
      </div>
    </div>
  </section>

  <footer class="footer">
    <div class="container">¬© <span id="y"></span> Curso: Literatura espa√±ola hasta el siglo XVIII ¬∑ Centro de Lenguas Modernas - Universidad de Granada ¬∑ Profesor Javier Ben√≠tez La√≠nez</div>
  </footer>

  <!-- Visor PDF -->
  <div class="overlay" id="overlay"></div>
  <div class="viewer" id="viewer">
    <div class="top">
      <strong id="fileName">Documento</strong>
      <div class="spacer"></div>
      <a class="btn" id="openTab" target="_blank" rel="noopener">Abrir en pesta√±a</a>
      <a class="btn" id="download" download>Descargar</a>
      <button class="btn primary" id="closeViewer">Volver</button>
    </div>
    <iframe id="frame" title="Visor PDF" src="about:blank"></iframe>
  </div>

  <script>
    // A√±o
    document.getElementById('y').textContent = new Date().getFullYear();

    // Men√∫ m√≥vil
    const nav = document.getElementById('nav');
    const hamb = document.getElementById('hamb');
    hamb?.addEventListener('click', ()=> nav.classList.toggle('open'));
    document.querySelectorAll('#mobilePanel a').forEach(a=> a.addEventListener('click', ()=> nav.classList.remove('open')));

    // Visor PDF
    const overlay = document.getElementById('overlay');
    const viewer = document.getElementById('viewer');
    const frame = document.getElementById('frame');
    const openTab = document.getElementById('openTab');
    const download = document.getElementById('download');
    const fileName = document.getElementById('fileName');
    const closeViewer = document.getElementById('closeViewer');

    function openPDF(path){
      fileName.textContent = decodeURIComponent(path.split('/').pop());
      frame.src = path;
      openTab.href = path;
      download.href = path;
      overlay.classList.add('show');
      viewer.style.display = 'flex';
      document.body.style.overflow='hidden';
    }
    function closePDF(){
      overlay.classList.remove('show');
      viewer.style.display = 'none';
      frame.src = 'about:blank';
      document.body.style.overflow='';
    }
    overlay.addEventListener('click', closePDF);
    closeViewer.addEventListener('click', closePDF);

    // Delegaci√≥n: cualquier [data-pdf] abre visor
    document.addEventListener('click', (e)=>{
      const target = e.target.closest('[data-pdf]');
      if(target){
        e.preventDefault();
        openPDF(target.getAttribute('data-pdf'));
      }
    });

    // ---- Cuadernos (con Berceo + PPTX en Sesi√≥n 5) ----
    const CUADERNOS = {
      "Edad Media": {
        sesiones: [
          { t: 'Sesi√≥n 1 ¬∑ Literatura Medieval', href: 'materials/cuadernos/Sesion1_Literatura_Medieval.pdf' },
          { t: 'Sesi√≥n 2 ¬∑ L√≠rica Medieval', href: 'materials/cuadernos/Sesion2_Lirica_Medieval.pdf' },
          { t: 'Sesi√≥n 3 ¬∑ Cantar de Mio Cid', href: 'materials/cuadernos/Sesion3_Cantar_de_Mio_Cid.pdf' },

          { 
            t: 'Sesi√≥n 4 ¬∑ Cid vs. L√°zaro',
            href: 'materials/cuadernos/Sesion4_Cid_vs_Lazaro.pdf',
            extra: [
              { t: 'Prezi: Poema de Mio Cid', link: 'https://prezi.com/j-ant5c0s6f5/poema-de-mio-cid/?present=1' }
            ]
          },

          { 
            t: 'Sesi√≥n 5 ¬∑ Berceo',
            href: 'materials/cuadernos/Sesion5_Berceo.pdf',
            extra: [
              { t: 'Actividad: Gonzalo de Berceo (en Perplexity)', link: 'https://www.perplexity.ai/search/i-need-to-implement-this-propu-G8R.GrYzQg.SI9bZy41SEw?1=d#1' },
              { t: 'Presentaci√≥n: Gonzalo de Berceo (PPTX)', link: 'materials/cuadernos/Gonzalo_de_Berceo.pptx' }
            ]
          },

          { 
            t: 'Sesi√≥n 6 ¬∑ Arcipreste',
            href: 'materials/cuadernos/Sesion6_Arcipreste.pdf',
            extra: [
              { t: 'Presentaci√≥n: El Arcipreste de Hita', link: 'materials/presentaciones/Buen_Amor/index.html' }
            ]
          },
        ],
        extras: [
          { t: 'M√≥dulo 1 ¬∑ Literatura Medieval', href: 'materials/cuadernos/Modulo1_Literatura_Medieval.pdf' },
          { t: 'Lectura ¬∑ Afrenta de Corpes', href: 'materials/cuadernos/Lectura_Afrenta_de_Corpes.pdf' },
          { t: 'Lectura ¬∑ Bodas (hijas del Cid)', href: 'materials/cuadernos/Lectura_Bodas_Hijas_Cid.pdf' },
        ]
      },
      "Renacimiento": {
        sesiones: [
          { t: 'Sesi√≥n 7 ¬∑ Renacimiento', href: 'materials/cuadernos/Sesion7_Renacimiento.pdf',
           extra: [
              { t: 'Presentaci√≥n: De la Edad Media al Renacimiento', link: 'materials/presentaciones/renacimiento/index.html' },
              { t: 'Presentaci√≥n: Lazarillo de Tormes (12 diapositivas)', link: 'materials/presentaciones/renacimiento/lazarillo/index.html' },
             { t: 'PDF: De la Edad Media al Renacimiento', link: 'materials/presentaciones/Renacimiento.pdf' }
            ]
          },
      {
            t: 'Sesi√≥n 8 ¬∑ Garcilaso',
            href: 'materials/cuadernos/Sesion8_Garcilaso.pdf',
            extra: [
              { t: 'Garcilaso.pdf (documento actualizado)', link: 'materials/cuadernos/Garcilaso.pdf' }
            ]
          },
          { t: 'Sesi√≥n 9 ¬∑ Fray Luis & San Juan', href: 'materials/cuadernos/Sesion9_FrayLuis_SanJuan.pdf' },
        ],
        extras: []
      },
      "Cervantes": {
        sesiones: [
          { t: 'üìÑ Discurso de Marcela (adaptado CLM)', href: 'materials/cuadernos/Discurso_Marcela_ELE.pdf' },
          { t: '‚ùì Marcela: Preguntas', href: 'materials/cuadernos/Marcela_preguntas.pdf' }
        ],
        extras: [
          { t: 'ü™∂ MiniWeb Cervantes', link: 'materials/presentaciones/cervantes/index.html' }
        ]
      },
      "Barroco": {
        sesiones: [],
        extras: [
          { t: 'üé≠ Sesi√≥n 11 ¬∑ MiniWeb Barroco: Contexto y claves', link: 'materials/presentaciones/barroco/index.html' }
        ]
      },
      "Ilustraci√≥n": { sesiones: [], extras: [] },
    };

    function renderCuadernos(epoca, chipsId, listId){
      const data = CUADERNOS[epoca] || { sesiones: [], extras: [] };
      const chips = document.getElementById(chipsId);
      const list = document.getElementById(listId);
      if(!chips || !list) return;

      chips.innerHTML = '';
      list.innerHTML = '';

      data.sesiones.forEach((s)=>{
        const span = document.createElement('span');
        span.className = 'chip';
        span.textContent = s.t;
        span.onclick = ()=>{
          document.querySelectorAll('#'+chipsId+' .chip').forEach(c=>c.classList.remove('active'));
          span.classList.add('active');

          // Bot√≥n del PDF principal
          list.innerHTML = `<li><button class="btn primary" data-pdf="${s.href}">‚¨áÔ∏è Abrir/descargar (${s.t})</button></li>`;

          // Extras (enlaces externos o archivos no-PDF, como PPTX)
          if (s.extra && Array.isArray(s.extra)) {
            s.extra.forEach(e => {
              list.innerHTML += `<li><a class="btn" href="${e.link}" target="_blank" rel="noopener">üåê ${e.t}</a></li>`;
            });
          }
        };
        chips.appendChild(span);
      });

      if(data.sesiones[0]){
        setTimeout(()=> chips.querySelector('.chip')?.click(), 0);
      } else {
        list.innerHTML = '<li class="muted">No hay cuadernos subidos para esta √©poca (todav√≠a).</li>';
      }

      if(data.extras && data.extras.length){
        const extrasHeader = document.createElement('h4');
        extrasHeader.textContent = 'Lecturas y materiales extra';
        extrasHeader.style.marginTop = '.75rem';
        list.parentElement.appendChild(extrasHeader);
        const ulExtras = document.createElement('ul'); ulExtras.className = 'list';
        data.extras.forEach(e=>{
          const li = document.createElement('li');
          // Si tiene 'link', abrir en nueva pesta√±a; si tiene 'href', usar data-pdf
          if (e.link) {
            li.innerHTML = `<a class="btn primary" href="${e.link}" target="_blank" rel="noopener">üåê ${e.t}</a>`;
          } else if (e.href) {
            li.innerHTML = `<button class="btn" data-pdf="${e.href}">‚¨áÔ∏è ${e.t}</button>`;
          }
          ulExtras.appendChild(li);
        });
        list.parentElement.appendChild(ulExtras);
      }
    }

    renderCuadernos('Edad Media','chips-edad-media','lista-edad-media');
    renderCuadernos('Renacimiento','chips-renacimiento','lista-renacimiento');
    renderCuadernos('Cervantes','chips-cervantes','lista-cervantes');
    renderCuadernos('Barroco','chips-barroco','lista-barroco');
    renderCuadernos('Ilustraci√≥n','chips-ilustracion','lista-ilustracion');

    // Flashcards (Repaso)
    const flashContainer = document.getElementById('flashcards');
    const flashMeta = document.getElementById('flashMeta');
    const shuffleBtn = document.getElementById('shuffleCards');
    const resetBtn = document.getElementById('resetCards');
    let flashOriginal = [];
    let flashCurrent = [];

    function parseCSV(text){
      const rows=[]; let row=[]; let field=''; let inQuotes=false;
      for(let i=0;i<text.length;i++){
        const c=text[i];
        if(c === '"'){
          if(inQuotes && text[i+1] === '"'){ field+='"'; i++; }
          else{ inQuotes=!inQuotes; }
        } else if(c === ',' && !inQuotes){
          row.push(field.trim()); field='';
        } else if((c === '\n' || c === '\r') && !inQuotes){
          if(c === '\r' && text[i+1] === '\n'){ i++; }
          row.push(field.trim()); if(row.some(v=>v!=='')){ rows.push(row); } row=[]; field='';
        } else {
          field+=c;
        }
      }
      if(field || row.length){ row.push(field.trim()); rows.push(row); }
      return rows;
    }

    function renderFlashcards(data){
      if(!flashContainer) return;
      flashContainer.innerHTML='';
      data.forEach((card, idx)=>{
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'flashcard';
        btn.innerHTML = `
          <div class="flash-label">Tarjeta ${idx+1}</div>
          <div class="flash-question">${card.q}</div>
          <div class="flash-answer">${card.a}</div>
        `;
        btn.addEventListener('click', ()=> btn.classList.toggle('show-answer'));
        flashContainer.appendChild(btn);
      });
      if(flashMeta){
        flashMeta.textContent = data.length ? `${data.length} tarjetas listas.` : 'No se pudieron cargar las tarjetas.';
      }
    }

    function shuffleFlashcards(){
      const arr = [...flashCurrent];
      for(let i=arr.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      flashCurrent = arr;
      renderFlashcards(flashCurrent);
    }

    function resetFlashcards(){
      flashCurrent = [...flashOriginal];
      renderFlashcards(flashCurrent);
    }

    fetch('materials/flashcards.csv')
      .then(res=>res.text())
      .then(text=>{
        const rows = parseCSV(text).filter(r=>r[0] && r[1]);
        flashOriginal = rows.map(([q,a])=>({ q, a }));
        flashCurrent = [...flashOriginal];
        renderFlashcards(flashCurrent);
      })
      .catch(()=>{
        if(flashMeta) flashMeta.textContent = 'No se pudieron cargar las tarjetas.';
      });

    shuffleBtn?.addEventListener('click', shuffleFlashcards);
    resetBtn?.addEventListener('click', resetFlashcards);

    // Cuestionario interactivo
    const QUIZ = [
      {
        q: '¬øQu√© obra an√≥nima de 1554 se considera fundadora de la novela picaresca por su realismo crudo y cr√≠tica social?',
        opts: ['El Busc√≥n','Fuenteovejuna','La vida de Lazarillo de Tormes','Don Quijote de la Mancha'],
        correct: 'C',
        hint: 'Piensa en el primer antih√©roe que narra su propia historia de supervivencia al servicio de varios amos.'
      },
      {
        q: '¬øQu√© innovaci√≥n trajo el Lazarillo en su lenguaje literario?',
        opts: ['Uso de octavas reales','Legitim√≥ el coloquialismo con estilo directo y aut√©ntico','Introdujo el verso libre','Uso de alegor√≠as mitol√≥gicas'],
        correct: 'B',
        hint: 'Su fuerza est√° en sonar a habla viva.'
      },
      {
        q: '¬øQu√© cuatro autores simbolizan el esplendor del Barroco espa√±ol?',
        opts: ['Lope, Calder√≥n, G√≥ngora y Quevedo','Garcilaso, Fray Luis, San Juan, G√≥ngora','Cervantes, Lope, Morat√≠n, Cadalso','B√©cquer, Zorrilla, Larra, Mesonero'],
        correct: 'A',
        hint: 'Piensa en teatro y en las dos corrientes est√©ticas contrapuestas.'
      },
      {
        q: '¬øCu√°l de estos pares representa las corrientes barrocas enfrentadas?',
        opts: ['Neoclasicismo vs. Romanticismo','Culteranismo vs. Conceptismo','Naturalismo vs. Realismo','Vanguardia vs. Costumbrismo'],
        correct: 'B',
        hint: 'G√≥ngora y Quevedo encarnan cada una.'
      },
      {
        q: '¬øEn qu√© espacio surgi√≥ el teatro como entretenimiento de masas durante el Barroco?',
        opts: ['Palacios reales','Universidades','Corrales de comedias','Salones ilustrados'],
        correct: 'C',
        hint: 'Era un patio urbano acondicionado para el p√∫blico.'
      },
      {
        q: '¬øQu√© batalla marc√≥ a Cervantes y le dio su apodo?',
        opts: ['Pav√≠a','Lepanto','San Quint√≠n','Trafalgar'],
        correct: 'B',
        hint: 'Perdi√≥ movilidad en la mano izquierda all√≠.'
      },
      {
        q: '¬øC√≥mo se llama la t√©cnica cervantina que muestra varias miradas sobre una misma realidad?',
        opts: ['Metalenguaje','Perspectivismo','Polis√≠ndeton','Iron√≠a tr√°gica'],
        correct: 'B',
        hint: 'Multiplica los puntos de vista.'
      },
      {
        q: '¬øQu√© tensi√≥n recorre el Quijote seg√∫n el temario?',
        opts: ['Feudalismo vs. capitalismo','Idealismo vs. realidad','Religi√≥n vs. ciencia','Tragedia vs. comedia'],
        correct: 'B',
        hint: 'El choque entre la visi√≥n del caballero y lo que sucede.'
      },
      {
        q: '¬øQu√© rasgo define el cambio del Barroco a la Ilustraci√≥n seg√∫n el curso?',
        opts: ['De la claridad a la oscuridad','De la regla a la licencia','Del exceso barroco a la regla y claridad','Del teatro a la √©pica'],
        correct: 'C',
        hint: 'El siglo XVIII busca luz y norma.'
      },
      {
        q: '¬øCu√°l es el gran contraste entre Renacimiento y Barroco mencionado?',
        opts: ['Clasicismo vs. medievalismo','Equilibrio vs. contraste','Prosa vs. poes√≠a','Narrativa vs. teatro'],
        correct: 'B',
        hint: 'Uno busca armon√≠a, el otro choque y relieve.'
      },
    ];

    const quizQuestion = document.getElementById('quizQuestion');
    const quizOptions = document.getElementById('quizOptions');
    const quizProgress = document.getElementById('quizProgress');
    const quizScore = document.getElementById('quizScore');
    const quizFeedback = document.getElementById('quizFeedback');
    const quizHintBtn = document.getElementById('quizHint');
    const quizCheckBtn = document.getElementById('quizCheck');
    const quizNextBtn = document.getElementById('quizNext');
    const quizHintText = document.getElementById('quizHintText');

    let quizIndex = 0;
    let quizSelected = null;
    let quizPoints = 0;
    let answered = false;

    function renderQuiz(){
      const item = QUIZ[quizIndex];
      quizSelected = null; answered = false;
      quizQuestion.textContent = item.q;
      quizOptions.innerHTML = '';
      ['A','B','C','D'].forEach((letter,i)=>{
        const btn = document.createElement('button');
        btn.innerHTML = `<span class="letter">${letter}.</span> <span>${item.opts[i]}</span>`;
        btn.onclick = ()=> {
          quizSelected = letter;
          quizOptions.querySelectorAll('button').forEach(b=> b.classList.remove('active'));
          btn.classList.add('active');
        };
        quizOptions.appendChild(btn);
      });
      quizProgress.textContent = `Pregunta ${quizIndex+1}/${QUIZ.length}`;
      quizScore.textContent = `Aciertos: ${quizPoints}`;
      quizFeedback.textContent = '';
      quizFeedback.className = 'quiz-feedback';
      quizHintText.textContent = '';
      quizHintText.classList.remove('show');
    }

    function checkQuiz(){
      if(quizSelected === null){
        quizFeedback.textContent = 'Selecciona una opci√≥n antes de comprobar.';
        quizFeedback.className = 'quiz-feedback bad';
        return;
      }
      const correct = QUIZ[quizIndex].correct === quizSelected;
      if(correct && !answered){
        quizPoints++;
        quizScore.textContent = `Aciertos: ${quizPoints}`;
      }
      answered = true;
      quizFeedback.textContent = correct ? '‚úÖ ¬°Correcto!' : `‚ùå Incorrecto. La respuesta correcta es ${QUIZ[quizIndex].correct}.`;
      quizFeedback.className = `quiz-feedback ${correct ? 'ok' : 'bad'}`;
    }

    function nextQuiz(){
      quizIndex++;
      if(quizIndex >= QUIZ.length){
        quizFeedback.textContent = `Fin del cuestionario. Puntuaci√≥n final: ${quizPoints}/${QUIZ.length}. Reiniciamos.`;
        quizFeedback.className = 'quiz-feedback ok';
        quizIndex = 0;
        quizPoints = 0;
      }
      renderQuiz();
    }

    quizCheckBtn?.addEventListener('click', checkQuiz);
    quizNextBtn?.addEventListener('click', nextQuiz);
    quizHintBtn?.addEventListener('click', ()=>{
      const hint = QUIZ[quizIndex].hint;
      quizHintText.textContent = hint;
      quizHintText.classList.add('show');
    });

    renderQuiz();

    // Miniserie
    const plantilla = (obra) => `# ${obra} ‚Äî Guion breve (B1)

T√≠tulo de la escena:
Lugar y √©poca: _______________
Personajes: [Nombre (√©poca/estamento), Objetivo, Obst√°culo, Visi√≥n]

[ACOTACI√ìN] (ambientaci√≥n, vestuario, luz)

DI√ÅLOGO (m√°x. 2-3 p√°ginas)
- Personaje A: (frase de intenci√≥n)
- Personaje B: (respuesta)

[Lectura cr√≠tica]
- ¬øQu√© mirada del mundo aparece?
- ¬øQu√© contradicciones muestra el texto?
- ¬øQu√© rasgos sociales del momento aflora?

[PERFORMATIVO]
- Pausas y √©nfasis si es recital.
- Entrada/salida si es teatro o cine.
`;

    const obra = document.getElementById('obra');
    const titulo = document.getElementById('titulo');
    const sinopsis = document.getElementById('sinopsis');
    const guion = document.getElementById('guion');

    document.getElementById('plantilla')?.addEventListener('click', ()=> { guion.value = plantilla(obra.value); });
    document.getElementById('limpiar')?.addEventListener('click', ()=> { titulo.value=''; sinopsis.value=''; guion.value=''; });
    document.getElementById('guardar')?.addEventListener('click', ()=>{
      const name = `${obra.value}-${(titulo.value||'capitulo').replace(/\s+/g,'_')}.txt`;
      const content = guion.value || plantilla(obra.value);
      const blob = new Blob([content], {type:'text/plain;charset=utf-8'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = name; document.body.appendChild(a); a.click();
      setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 0);
    });
  </script>
</body>
</html>
